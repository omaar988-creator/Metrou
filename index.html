<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metrou App ğŸš‡</title>
    <style>
        :root { --main-bg: #131f24; --accent: #58cc02; --wrong: #ff4b4b; }
        body { background: var(--main-bg); color: white; font-family: sans-serif; text-align: center; margin: 0; padding-bottom: 50px; }
        .header { padding: 20px; background: #202f36; font-size: 1.5rem; font-weight: bold; border-bottom: 2px solid var(--accent); }
        .stats { display: flex; justify-content: space-around; padding: 15px; background: #131f24; position: sticky; top: 0; z-index: 100; }
        .track { display: flex; flex-direction: column; align-items: center; gap: 40px; padding: 40px 0; }
        .node { width: 70px; height: 70px; background: white; border-radius: 50%; border: 5px solid var(--accent); display: flex; align-items: center; justify-content: center; color: black; font-weight: bold; font-size: 1.2rem; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(88, 204, 2, 0.4); }
        .node.locked { border-color: #3b4c54; background: #202f36; color: #3b4c54; box-shadow: none; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù…ÙØªØ´ ÙˆØ§Ù„Ø¯Ø±ÙˆØ³ */
        #modal-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .btn { background: var(--accent); color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 1.1rem; margin-top: 20px; width: 80%; cursor: pointer; }
        .punishment { color: var(--wrong); margin-top: 15px; font-weight: bold; }
        .lesson-box { background: #202f36; padding: 20px; border-radius: 15px; border: 1px solid var(--accent); width: 85%; }
    </style>
</head>
<body>

    <div class="header">Ù…ØªØ±Ùˆ: Ø±Ø­Ù„Ø© Ø§Ù„Ù„ØºØ© ğŸš‡</div>
    
    <div class="stats">
        <div style="color: #ffc800;">â­ <span id="pts">0</span></div>
        <div style="color: var(--wrong);">âš¡ <span id="nrg">5</span></div>
    </div>

    <div class="track" id="nodes-container">
        <div class="node" onclick="openLesson('Ø§Ù„ØªØ±Ø­ÙŠØ¨')">1</div>
        <div class="node locked" onclick="triggerInspector('Ø§Ù„Ø£ÙØ¹Ø§Ù„')">2</div>
        <div class="node locked" onclick="triggerInspector('Ø§Ù„Ø£Ø±Ù‚Ø§Ù…')">3</div>
    </div>

    <div id="modal-screen">
        <div id="content-area" class="lesson-box">
            <h2 id="modal-title">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>
            <p id="modal-body"></p>
            <div id="inspector-controls" style="display:none;">
                <button class="btn" onclick="resolve(true)">Ø£Ø¹Ø±Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© âœ…</button>
                <button class="btn" style="background: #3b4c54;" onclick="resolve(false)">Ù„Ø§ Ø£Ø¹Ø±Ù (Ø¹Ù‚Ø§Ø¨)</button>
            </div>
            <button class="btn" id="close-btn" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <p id="punish-msg" class="punishment"></p>
    </div>

    <script>
        const API_URL = "https://metrou-db.onrender.com";
        let energy = 5;
        let points = 0;

        async function openLesson(lessonName) {
            showModal("Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„Ø¯Ø±Ø³...", "Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹...");
            try {
                const res = await fetch(`${API_URL}/api/lessons`);
                const lessons = await res.json();
                const lesson = lessons.find(l => l.title === lessonName || l.title_ar === lessonName);
                
                if (lesson) {
                    showModal(`ğŸ“– ${lesson.title}`, lesson.content);
                } else {
                    showModal("ØªÙ†Ø¨ÙŠÙ‡", "Ø§Ù„Ù…ÙØªØ´: Ù„Ù… ÙŠØ¶Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…Ø­ØªÙˆÙ‰ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ Ø¨Ø¹Ø¯!");
                }
            } catch (e) {
                showModal("Ø®Ø·Ø£", "ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¹Ù‚Ù„. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ¹Ù…Ù„.");
            }
        }

        async function triggerInspector(topic) {
            if (energy <= 0) return alert("Ù†ÙØ¯Øª Ø·Ø§Ù‚ØªÙƒ!");
            showModal("ğŸ‘®â€â™‚ï¸ ØªÙØªÙŠØ´ Ù…ÙØ§Ø¬Ø¦!", "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø³Ø¤Ø§Ù„...", true);
            
            try {
                const res = await fetch(`${API_URL}/api/ai/inspect`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ topic: topic })
                });
                const data = await res.json();
                document.getElementById('modal-body').innerText = data.question;
            } catch (e) {
                document.getElementById('modal-body').innerText = "Ø§Ù„Ù…ÙØªØ´: ØªØ±Ø¬Ù… ÙƒÙ„Ù…Ø© 'Bonjour' ÙÙˆØ±Ø§Ù‹ Ù„Ù„Ù…Ø±ÙˆØ±!";
            }
        }

        function showModal(title, body, isInspector = false) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-body').innerText = body;
            document.getElementById('modal-screen').style.display = 'flex';
            document.getElementById('inspector-controls').style.display = isInspector ? 'block' : 'none';
            document.getElementById('close-btn').style.display = isInspector ? 'none' : 'block';
        }

        function closeModal() {
            document.getElementById('modal-screen').style.display = 'none';
            document.getElementById('punish-msg').innerText = "";
        }

        function resolve(success) {
            const punishMsg = document.getElementById('punish-msg');
            if (success) {
                points += 15;
                document.getElementById('pts').innerText = points;
                punishMsg.style.color = "#58cc02";
                punishMsg.innerText = "Ø£Ø­Ø³Ù†Øª! Ø§Ù„Ù…ÙØªØ´ Ø³Ù…Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ù…Ø±ÙˆØ±. ğŸ«";
            } else {
                energy--;
                document.getElementById('nrg').innerText = energy;
                punishMsg.innerText = "Ø¹Ù‚Ø§Ø¨Ùƒ: Ù‚Ù Ø¹Ù„Ù‰ Ø±Ø¬Ù„ ÙˆØ§Ø­Ø¯Ø© Ù„Ù…Ø¯Ø© Ø¯Ù‚ÙŠÙ‚Ø©! ğŸ¦µ";
            }
            setTimeout(closeModal, 3000);
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metrou App - Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ğŸš‡</title>
    <style>
        :root { --main-bg: #131f24; --accent: #58cc02; --wrong: #ff4b4b; --card: #202f36; }
        body { background: var(--main-bg); color: white; font-family: sans-serif; text-align: center; margin: 0; padding-bottom: 50px; }
        .header { padding: 20px; background: var(--card); font-size: 1.5rem; font-weight: bold; border-bottom: 3px solid var(--accent); }
        .track { display: flex; flex-direction: column; align-items: center; gap: 40px; padding: 40px 0; }
        .node { width: 75px; height: 75px; background: white; border-radius: 50%; border: 5px solid var(--accent); display: flex; align-items: center; justify-content: center; color: black; font-weight: bold; font-size: 1.3rem; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(88, 204, 2, 0.4); }
        
        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø±Ø³ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø± */
        #modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; padding: 20px; box-sizing: border-box; }
        .box { background: var(--card); padding: 25px; border-radius: 20px; border: 2px solid var(--accent); width: 90%; max-width: 400px; text-align: right; }
        .example { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin: 10px 0; border-right: 4px solid var(--accent); }
        
        .btn { background: var(--accent); color: white; border: none; padding: 15px; border-radius: 12px; font-size: 1.1rem; width: 100%; cursor: pointer; margin-top: 15px; font-weight: bold; }
        .option-btn { background: #3b4c54; margin-bottom: 10px; text-align: right; font-size: 1rem; }
        .wrong { background: var(--wrong) !important; }
    </style>
</head>
<body>

    <div class="header">Ù…ØªØ±Ùˆ: Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ğŸ“š</div>
    
    <div class="track">
        <div class="node" onclick="loadLesson('GR-001')">1</div>
        <div class="node" onclick="loadLesson('GR-002')">2</div>
        <div class="node" onclick="loadLesson('GR-003')">3</div>
    </div>

    <div id="modal">
        <div class="box" id="modal-content">
            </div>
    </div>

    <script>
        const API_URL = "https://metrou-db.onrender.com";
        let currentLessonData = null;

        async function loadLesson(lessonId) {
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('modal-content').innerHTML = "<h2>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø³...</h2>";
            
            try {
                const res = await fetch(`${API_URL}/api/lessons`);
                const lessons = await res.json();
                currentLessonData = lessons.find(l => l.id === lessonId);
                
                if (currentLessonData) {
                    showLessonUI();
                }
            } catch (e) {
                alert("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
            }
        }

        function showLessonUI() {
            let examplesHtml = currentLessonData.examples.map(ex => 
                `<div class="example"><b>FR:</b> ${ex.fr}<br><b>AR:</b> ${ex.ar}</div>`
            ).join('');

            document.getElementById('modal-content').innerHTML = `
                <h2 style="color:var(--accent)">${currentLessonData.title}</h2>
                <p>${currentLessonData.content}</p>
                <div style="font-size:0.9rem; color:#ccc;">${currentLessonData.details}</div>
                ${examplesHtml}
                <button class="btn" onclick="startQuiz()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ âœï¸</button>
                <button class="btn" style="background:#555" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
            `;
        }

        function startQuiz() {
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ù†Ø§ Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¬Ù„Ø¨ Ø³Ø¤Ø§Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            document.getElementById('modal-content').innerHTML = `
                <h2 style="color:var(--accent)">Ø§Ø®ØªØ¨Ø± ÙÙ‡Ù…Ùƒ!</h2>
                <p id="q-text">Ø³Ø¤Ø§Ù„ Ù…Ø³ØªØ®Ø±Ø¬ Ù…Ù† Ø§Ù„Ù…Ø°ÙƒØ±Ø©: Ù…Ø§ Ù‡ÙŠ Ø£Ø¯Ø§Ø© Ø§Ù„Ù†ÙƒØ±Ø© Ù„Ù„Ù…Ø°ÙƒØ±ØŸ</p>
                <button class="btn option-btn" onclick="checkAnswer(this, true)">1- Un</button>
                <button class="btn option-btn" onclick="checkAnswer(this, false)">2- Une</button>
                <button class="btn option-btn" onclick="checkAnswer(this, false)">3- Des</button>
            `;
        }

        function checkAnswer(btn, isCorrect) {
            if(isCorrect) {
                btn.style.background = "#58cc02";
                alert("Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! Ø£Ø­Ø³Ù†Øª ÙŠØ§ Ø¨Ø·Ù„. ğŸ‰");
                closeModal();
            } else {
                btn.classList.add('wrong');
                alert("Ù„Ù„Ø£Ø³Ù Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¯Ø±Ø³ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. âŒ");
            }
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }
    </script>
</body>
</html>
