<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metrou App ğŸš‡</title>
    <style>
        :root { --main-bg: #131f24; --accent: #58cc02; --wrong: #ff4b4b; }
        body { background: var(--main-bg); color: white; font-family: sans-serif; text-align: center; margin: 0; padding-bottom: 50px; }
        .header { padding: 20px; background: #202f36; font-size: 1.5rem; font-weight: bold; border-bottom: 2px solid var(--accent); }
        .stats { display: flex; justify-content: space-around; padding: 15px; background: #131f24; position: sticky; top: 0; z-index: 100; }
        .track { display: flex; flex-direction: column; align-items: center; gap: 40px; padding: 40px 0; }
        .node { width: 70px; height: 70px; background: white; border-radius: 50%; border: 5px solid var(--accent); display: flex; align-items: center; justify-content: center; color: black; font-weight: bold; font-size: 1.2rem; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(88, 204, 2, 0.4); }
        .node.locked { border-color: #3b4c54; background: #202f36; color: #3b4c54; box-shadow: none; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù…ÙØªØ´ */
        #inspector { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .btn { background: var(--accent); color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 1.1rem; margin-top: 20px; width: 80%; }
        .punishment { color: var(--wrong); margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">Ù…ØªØ±Ùˆ: Ø±Ø­Ù„Ø© Ø§Ù„Ù„ØºØ© ğŸš‡</div>
    
    <div class="stats">
        <div style="color: #ffc800;">â­ <span id="pts">0</span></div>
        <div style="color: var(--wrong);">âš¡ <span id="nrg">5</span></div>
    </div>

    <div class="track" id="nodes-container">
        <div class="node" onclick="openLesson('Ø§Ù„ØªØ±Ø­ÙŠØ¨')">1</div>
        <div class="node locked" onclick="triggerInspector('Ø§Ù„Ø£ÙØ¹Ø§Ù„')">2</div>
        <div class="node locked" onclick="triggerInspector('Ø§Ù„Ø£Ø±Ù‚Ø§Ù…')">3</div>
    </div>

    <div id="inspector">
        <div style="font-size: 80px;">ğŸ‘®â€â™‚ï¸</div>
        <h2 style="color: var(--wrong);">ØªÙØªÙŠØ´ Ù…ÙØ§Ø¬Ø¦!</h2>
        <p id="q-text" style="font-size: 1.2rem;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ÙØªØ´...</p>
        <button class="btn" onclick="resolve(true)">Ø£Ø¹Ø±Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© âœ…</button>
        <button class="btn" style="background: #3b4c54;" onclick="resolve(false)">Ù„Ø§ Ø£Ø¹Ø±Ù (Ø®ØµÙ… Ø·Ø§Ù‚Ø©)</button>
        <p id="punish-msg" class="punishment"></p>
    </div>

    <script>
        const API_URL = "https://metrou-db.onrender.com";
        let energy = 5;
        let points = 0;

        function openLesson(name) {
            alert("Ø¨Ø¯Ø¡ Ø¯Ø±Ø³: " + name);
        }

        async function triggerInspector(topic) {
            if (energy <= 0) return alert("Ù†ÙØ¯Øª Ø·Ø§Ù‚ØªÙƒ! Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ØªØ´Ø­Ù†.");
            document.getElementById('inspector').style.display = 'flex';
            
            try {
                const res = await fetch(`${API_URL}/api/ai/inspect`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ topic: topic })
                });
                const data = await res.json();
                document.getElementById('q-text').innerText = data.question;
            } catch (e) {
                document.getElementById('q-text').innerText = "Ø§Ù„Ù…ÙØªØ´: ØªØ±Ø¬Ù… ÙƒÙ„Ù…Ø© 'Bonjour' ÙÙˆØ±Ø§Ù‹!";
            }
        }

        function resolve(success) {
            const punishMsg = document.getElementById('punish-msg');
            if (success) {
                points += 15;
                document.getElementById('pts').innerText = points;
                punishMsg.style.color = "#58cc02";
                punishMsg.innerText = "Ø£Ø­Ø³Ù†Øª! Ø§Ù„Ù…ÙØªØ´ Ø³Ù…Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ù…Ø±ÙˆØ±. ğŸ«";
            } else {
                energy--;
                document.getElementById('nrg').innerText = energy;
                const punishments = ["Ø¹Ù‚Ø§Ø¨Ùƒ: Ù‚Ù Ø¹Ù„Ù‰ Ø±Ø¬Ù„ ÙˆØ§Ø­Ø¯Ø©! ğŸ¦µ", "Ø¹Ù‚Ø§Ø¨Ùƒ: Ø§Ù„Ù…Ø³ Ø£Ù†ÙÙƒ Ø¨Ù„Ø³Ø§Ù†Ùƒ! ğŸ‘…"];
                punishMsg.innerText = punishments[Math.floor(Math.random()*punishments.length)];
            }

            setTimeout(() => {
                document.getElementById('inspector').style.display = 'none';
                punishMsg.innerText = "";
            }, 3000);
        }
    </script>
</body>
</html>
